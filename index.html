<!DOCTYPE html>
<html lang="kr">
<head>
		<meta charset="utf-8">
		<title>Visualization 2016 Fall | Final Project</title>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<style>
		.title {
			text-align: center;
			letter-spacing: 3px;
			font-family: "Lucida Console", Fixdsys, monospace;
		}
		h1 {
			font-size: 50px;
			margin: 15px;
			margin-top: 25px;
		}
		h2 {
			font-size: 20px;
			margin: 8px;
		}
		svg {
			font-family: "Lucida Console", Fixdsys, monospace;
			cursor: crosshair;
		}
		</style>
	</head>
	<body>
		<div>
			<h1 class="title">Visualization_2016F</h1>
			<h2 class="title">Final Project by Wonryong Ryou</h2>
			<h2 class="title">"Chronicle of U.S. Supreme Court based on Median Justices"</h2>
		</div>
		<div id="final_project" align="center"></div>
		<script type="text/javascript">
			var w = 900, h = 800;
			var margin = {top:10, right:20, bottom: 10, left: 20};
			var ext_space = 120;
			var innerW = w - margin.right - margin.left,
				innerH = h - margin.top - margin.bottom - ext_space,
				centerW = w / 2;
			var on_mouse = null;
			var legend_click = 0;
			var box_click = null;

			var chipHeight = 10,
				chipPadding = 2,
				legendWidth = 140,
				legendHeight = 10,
				legendPadding = 5;

			var xDomain = [-5, 5],
				yDomain = [1976, 2015],
				xRange = [-centerW / 3, centerW / 3];
				yRange = [0 + margin.top, innerH - margin.bottom];

			d3.csv('https://raw.githubusercontent.com/luwalong/practiceGit/master/justice_case_score.CSV', function(case_data) {
			d3.csv('https://raw.githubusercontent.com/luwalong/practiceGit/master/mqs.CSV', function(mqs_data) {

				case_data = d3.nest()
					.key(function(d){return d.idx;})
					.entries(case_data);
				mqs_data = d3.nest()
					.key(function(d){return d.year;})
					.sortValues(function(a,b) {return a.mqs - b.mqs;})
					.entries(mqs_data);

				case_data = case_data.filter(function(e){
					for(i = 0; i < mqs_data.length; i ++)
						for(j = 0; j < mqs_data[i].values.length; j ++)
							if(mqs_data[i].values[j].jus_code === e.key)
								return true;
					return false;
				});

				var selected = Array.apply(null, Array(150))
					.map(function(x, i){return 0;});

				function findName(i){
					for(k = 0; k < case_data.length; k ++)
						if(case_data[k].key === i)
							return case_data[k].values[0].jus_name;
				}

				var svg = d3.select('#final_project').append('svg')
					.attr('width', w)
					.attr('height', h)
					.append('g')
					.attr('transform', 'translate('+ [margin.left, margin.top] + ')');

				var color = d3.scaleLinear()
					.domain([-5, 0, 5])
					.range(['blue', 'white', 'red']);
				var x = d3.scaleLinear()
					.domain(xDomain)
					.range(xRange);
				var y = d3.scaleLinear()
					.domain(yDomain)
					.range(yRange);

				var xGap = x(1) - x(0);
				var yGap = y(2001) - y(2000);

				var plot = svg.selectAll('.plot')
					.data(mqs_data, function(d){return d.key;})
					.enter()
					.append('g')
					.attr('class', 'plot')
					.attr('transform', function(d){return 'translate(' + [centerW - margin.left, y(d.key)] + ')';});

				var legend = svg.selectAll('.legend')
					.data(case_data.map(function(d){return d.key;}))
					.enter()
					.append('g')
					.attr('class', 'legend')
					.attr('transform', function(d,i){
						return 'translate(' + [innerW - legendWidth - margin.right, i *(legendHeight + legendPadding)]+ ')'
					});

				legend.append('rect')
					.attr('y', chipPadding).attr('x', legendWidth + margin.right - chipPadding)
					.attr('width', chipHeight).attr('height', chipHeight)
					.style('stroke', 'black')
					.style('fill', 'white');

				legend.append('text')
					.attr('x', function(d){return legendWidth - findName(d).length * 6 + chipPadding+ chipHeight;})
					.attr('y', chipPadding)
					.attr('dy', '.71em')
					.style('font-size', legendHeight+ 'px')
					.text(function(d){return findName(d);});

				var boxes = plot.selectAll('.box')
					.data(function(d){return d.values;})
					.enter()
					.append('rect')
					.attr('class', 'box')
					.attr('fill', function(d){return color(d.mqs);})
					.attr('width', xGap - 7).attr('height', yGap - 4)
					.style('stroke', 'black')
					.attr('transform', function(d,i){return 'translate(' + [x(i-4)/*x(d.mqs)*/, 0] + ')';});

				function plotUpdate(on){
					var t = d3.transition()
						.duration(on ? 100 : 500);

					boxes.transition(t)
						.attr('fill-opacity', function(d){
							if(selected[d.jus_code] || (!legend_click && !on ) || (on && d.jus_code === on.jus_code))
								return 1.0;
							else
								return 0.1;
						}).attr('stroke-width', function(d){
							if(selected[d.jus_code] || (on && d.jus_code === on.jus_code))
								return "2px";
							else
								return "1px";
						});

					legend.selectAll('text')
						.transition(t)
						.attr('stroke', function(d){
							if(selected[d] || (on && d === on.jus_code))
								return "#000000";
							else
								return null;
						});

					legend.selectAll('rect')
						.style('fill', function(d){
							console.log(d);
							return selected[d] ? 'black' : 'white';
						});
				}

				boxes.on('mouseover', function(d){
					plotUpdate(d);
				});

				boxes.on('mouseleave', function(d){
					plotUpdate(null);
				});

				legend.selectAll('rect')
					.on('click', function(d){
						if(!selected[d]){
							selected[d] = 1;
							legend_click ++;
						}
						else{
							selected[d] = 0;
							legend_click --;
						}
						plotUpdate(null);
					});
			});
			});
		</script>
	</body>
</html>